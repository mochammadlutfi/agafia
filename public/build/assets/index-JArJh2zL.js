import{aZ as F,g as ve,e as Ce,f as W,_ as ze,k as te,cy as ye,cz as Pe,cA as Ae,ab as Le,u as _e,bK as Be,r as C,cB as Me,a4 as Ve,c as m,w as me,ao as Ee,a5 as Se,a_ as H,p as pe,o as g,v as p,C as c,d as Fe,B as k,s as he,y as v,t as e,bP as He,ac as I,n as z,q as T,H as Ye,E as R,bF as De,N as Z,ae as Xe,ag as Ke,J as je,K as Ne,cC as qe,cD as We,x as Ze,cE as Ge,cF as Je,ah as Qe,bQ as Ue,a3 as fe,as as V,cb as ea,z as Oe,b0 as aa,b8 as ta,at as sa,cG as oa,au as be,aH as na,cH as ke,cI as Ie,bX as la,l as ra}from"./id-B7x6Kphd.js";import{m as $e}from"./typescript-Bp3YSIOJ.js";import{u as ia}from"./index-DQKi3PpE.js";import{a as ca}from"./scroll-BcTyIFjF.js";const ua=(u,x)=>{if(!F||!u||!x)return!1;const d=u.getBoundingClientRect();let n;return x instanceof Element?n=x.getBoundingClientRect():n={top:0,right:window.innerWidth,bottom:window.innerHeight,left:0},d.top<n.bottom&&d.bottom>n.top&&d.right>n.left&&d.left<n.right},da=Ce({urlList:{type:W(Array),default:()=>$e([])},zIndex:{type:Number},initialIndex:{type:Number,default:0},infinite:{type:Boolean,default:!0},hideOnClickModal:Boolean,teleported:Boolean,closeOnPressEscape:{type:Boolean,default:!0},zoomRate:{type:Number,default:1.2},minScale:{type:Number,default:.2},maxScale:{type:Number,default:7},showProgress:{type:Boolean,default:!1},crossorigin:{type:W(String)}}),fa={close:()=>!0,switch:u=>ve(u),rotate:u=>ve(u)},va=te({name:"ElImageViewer"}),ma=te({...va,props:da,emits:fa,setup(u,{expose:x,emit:d}){var n;const r=u,w={CONTAIN:{name:"contain",icon:ye(Ae)},ORIGINAL:{name:"original",icon:ye(Pe)}};let Y,D="";const{t:se}=Le(),s=_e("image-viewer"),{nextZIndex:P}=Be(),L=C(),M=C([]),A=Me(),f=C(!0),y=C(r.initialIndex),N=Ve(w.CONTAIN),l=C({scale:1,deg:0,offsetX:0,offsetY:0,enableTransition:!1}),oe=C((n=r.zIndex)!=null?n:P()),X=m(()=>{const{urlList:a}=r;return a.length<=1}),G=m(()=>y.value===0),K=m(()=>y.value===r.urlList.length-1),j=m(()=>r.urlList[y.value]),ne=m(()=>[s.e("btn"),s.e("prev"),s.is("disabled",!r.infinite&&G.value)]),le=m(()=>[s.e("btn"),s.e("next"),s.is("disabled",!r.infinite&&K.value)]),J=m(()=>{const{scale:a,deg:i,offsetX:o,offsetY:b,enableTransition:E}=l.value;let S=o/a,$=b/a;const q=i*Math.PI/180,ge=Math.cos(q),we=Math.sin(q);S=S*ge+$*we,$=$*ge-o/a*we;const de={transform:`scale(${a}) rotate(${i}deg) translate(${S}px, ${$}px)`,transition:E?"transform .3s":""};return N.value.name===w.CONTAIN.name&&(de.maxWidth=de.maxHeight="100%"),de}),Q=m(()=>`${y.value+1} / ${r.urlList.length}`);function B(){ee(),Y==null||Y(),document.body.style.overflow=D,d("close")}function U(){const a=fe(o=>{switch(o.code){case V.esc:r.closeOnPressEscape&&B();break;case V.space:_();break;case V.left:ce();break;case V.up:O("zoomIn");break;case V.right:ue();break;case V.down:O("zoomOut");break}}),i=fe(o=>{const b=o.deltaY||o.deltaX;O(b<0?"zoomIn":"zoomOut",{zoomRate:r.zoomRate,enableTransition:!1})});A.run(()=>{H(document,"keydown",a),H(document,"wheel",i)})}function ee(){A.stop()}function re(){f.value=!1}function ie(a){f.value=!1,a.target.alt=se("el.image.error")}function t(a){if(f.value||a.button!==0||!L.value)return;l.value.enableTransition=!1;const{offsetX:i,offsetY:o}=l.value,b=a.pageX,E=a.pageY,S=fe(q=>{l.value={...l.value,offsetX:i+q.pageX-b,offsetY:o+q.pageY-E}}),$=H(document,"mousemove",S);H(document,"mouseup",()=>{$()}),a.preventDefault()}function h(){l.value={scale:1,deg:0,offsetX:0,offsetY:0,enableTransition:!1}}function _(){if(f.value)return;const a=ea(w),i=Object.values(w),o=N.value.name,E=(i.findIndex(S=>S.name===o)+1)%a.length;N.value=w[a[E]],h()}function ae(a){const i=r.urlList.length;y.value=(a+i)%i}function ce(){G.value&&!r.infinite||ae(y.value-1)}function ue(){K.value&&!r.infinite||ae(y.value+1)}function O(a,i={}){if(f.value)return;const{minScale:o,maxScale:b}=r,{zoomRate:E,rotateDeg:S,enableTransition:$}={zoomRate:r.zoomRate,rotateDeg:90,enableTransition:!0,...i};switch(a){case"zoomOut":l.value.scale>o&&(l.value.scale=Number.parseFloat((l.value.scale/E).toFixed(3)));break;case"zoomIn":l.value.scale<b&&(l.value.scale=Number.parseFloat((l.value.scale*E).toFixed(3)));break;case"clockwise":l.value.deg+=S,d("rotate",l.value.deg);break;case"anticlockwise":l.value.deg-=S,d("rotate",l.value.deg);break}l.value.enableTransition=$}function Re(a){var i;((i=a.detail)==null?void 0:i.focusReason)==="pointer"&&a.preventDefault()}function Te(){r.closeOnPressEscape&&B()}function xe(a){if(a.ctrlKey){if(a.deltaY<0)return a.preventDefault(),!1;if(a.deltaY>0)return a.preventDefault(),!1}}return me(j,()=>{Ee(()=>{const a=M.value[0];a!=null&&a.complete||(f.value=!0)})}),me(y,a=>{h(),d("switch",a)}),Se(()=>{U(),Y=H("wheel",xe,{passive:!1}),D=document.body.style.overflow,document.body.style.overflow="hidden"}),x({setActiveItem:ae}),(a,i)=>(g(),pe(e(Ue),{to:"body",disabled:!a.teleported},{default:p(()=>[c(Fe,{name:"viewer-fade",appear:""},{default:p(()=>[k("div",{ref_key:"wrapper",ref:L,tabindex:-1,class:v(e(s).e("wrapper")),style:he({zIndex:oe.value})},[c(e(He),{loop:"",trapped:"","focus-trap-el":L.value,"focus-start-el":"container",onFocusoutPrevented:Re,onReleaseRequested:Te},{default:p(()=>[k("div",{class:v(e(s).e("mask")),onClick:Ye(o=>a.hideOnClickModal&&B(),["self"])},null,10,["onClick"]),I(" CLOSE "),k("span",{class:v([e(s).e("btn"),e(s).e("close")]),onClick:B},[c(e(R),null,{default:p(()=>[c(e(De))]),_:1})],2),I(" ARROW "),e(X)?I("v-if",!0):(g(),z(Z,{key:0},[k("span",{class:v(e(ne)),onClick:ce},[c(e(R),null,{default:p(()=>[c(e(Xe))]),_:1})],2),k("span",{class:v(e(le)),onClick:ue},[c(e(R),null,{default:p(()=>[c(e(Ke))]),_:1})],2)],64)),a.$slots.progress||a.showProgress?(g(),z("div",{key:1,class:v([e(s).e("btn"),e(s).e("progress")])},[T(a.$slots,"progress",{activeIndex:y.value,total:a.urlList.length},()=>[je(Ne(e(Q)),1)])],2)):I("v-if",!0),I(" ACTIONS "),k("div",{class:v([e(s).e("btn"),e(s).e("actions")])},[k("div",{class:v(e(s).e("actions__inner"))},[T(a.$slots,"toolbar",{actions:O,prev:ce,next:ue,reset:_,activeIndex:y.value,setActiveItem:ae},()=>[c(e(R),{onClick:o=>O("zoomOut")},{default:p(()=>[c(e(qe))]),_:1},8,["onClick"]),c(e(R),{onClick:o=>O("zoomIn")},{default:p(()=>[c(e(We))]),_:1},8,["onClick"]),k("i",{class:v(e(s).e("actions__divider"))},null,2),c(e(R),{onClick:_},{default:p(()=>[(g(),pe(Ze(e(N).icon)))]),_:1}),k("i",{class:v(e(s).e("actions__divider"))},null,2),c(e(R),{onClick:o=>O("anticlockwise")},{default:p(()=>[c(e(Ge))]),_:1},8,["onClick"]),c(e(R),{onClick:o=>O("clockwise")},{default:p(()=>[c(e(Je))]),_:1},8,["onClick"])])],2)],2),I(" CANVAS "),k("div",{class:v(e(s).e("canvas"))},[(g(!0),z(Z,null,Qe(a.urlList,(o,b)=>(g(),z(Z,{key:b},[b===y.value?(g(),z("img",{key:0,ref_for:!0,ref:E=>M.value[b]=E,src:o,style:he(e(J)),class:v(e(s).e("img")),crossorigin:a.crossorigin,onLoad:re,onError:ie,onMousedown:t},null,46,["src","crossorigin"])):I("v-if",!0)],64))),128))],2),T(a.$slots,"default")]),_:3},8,["focus-trap-el"])],6)]),_:3})]),_:3},8,["disabled"]))}});var pa=ze(ma,[["__file","image-viewer.vue"]]);const ga=Oe(pa),wa=Ce({hideOnClickModal:Boolean,src:{type:String,default:""},fit:{type:String,values:["","contain","cover","fill","none","scale-down"],default:""},loading:{type:String,values:["eager","lazy"]},lazy:Boolean,scrollContainer:{type:W([String,Object])},previewSrcList:{type:W(Array),default:()=>$e([])},previewTeleported:Boolean,zIndex:{type:Number},initialIndex:{type:Number,default:0},infinite:{type:Boolean,default:!0},closeOnPressEscape:{type:Boolean,default:!0},zoomRate:{type:Number,default:1.2},minScale:{type:Number,default:.2},maxScale:{type:Number,default:7},showProgress:{type:Boolean,default:!1},crossorigin:{type:W(String)}}),ya={load:u=>u instanceof Event,error:u=>u instanceof Event,switch:u=>ve(u),close:()=>!0,show:()=>!0},ha=te({name:"ElImage",inheritAttrs:!1}),ba=te({...ha,props:wa,emits:ya,setup(u,{expose:x,emit:d}){const n=u,{t:r}=Le(),w=_e("image"),Y=aa(),D=m(()=>ta(Object.entries(Y).filter(([t])=>/^(data-|on[A-Z])/i.test(t)||["id","style"].includes(t)))),se=ia({excludeListeners:!0,excludeKeys:m(()=>Object.keys(D.value))}),s=C(),P=C(!1),L=C(!0),M=C(!1),A=C(),f=C(),y=F&&"loading"in HTMLImageElement.prototype;let N;const l=m(()=>[w.e("inner"),X.value&&w.e("preview"),L.value&&w.is("loading")]),oe=m(()=>{const{fit:t}=n;return F&&t?{objectFit:t}:{}}),X=m(()=>{const{previewSrcList:t}=n;return sa(t)&&t.length>0}),G=m(()=>{const{previewSrcList:t,initialIndex:h}=n;let _=h;return h>t.length-1&&(_=0),_}),K=m(()=>n.loading==="eager"?!1:!y&&n.loading==="lazy"||n.lazy),j=()=>{F&&(L.value=!0,P.value=!1,s.value=n.src)};function ne(t){L.value=!1,P.value=!1,d("load",t)}function le(t){L.value=!1,P.value=!0,d("error",t)}function J(){ua(A.value,f.value)&&(j(),U())}const Q=oa(J,200,!0);async function B(){var t;if(!F)return;await Ee();const{scrollContainer:h}=n;la(h)?f.value=h:ra(h)&&h!==""?f.value=(t=document.querySelector(h))!=null?t:void 0:A.value&&(f.value=ca(A.value)),f.value&&(N=H(f,"scroll",Q),setTimeout(()=>J(),100))}function U(){!F||!f.value||!Q||(N==null||N(),f.value=void 0)}function ee(){X.value&&(M.value=!0,d("show"))}function re(){M.value=!1,d("close")}function ie(t){d("switch",t)}return me(()=>n.src,()=>{K.value?(L.value=!0,P.value=!1,U(),B()):j()}),Se(()=>{K.value?B():j()}),x({showPreview:ee}),(t,h)=>(g(),z("div",be({ref_key:"container",ref:A},e(D),{class:[e(w).b(),t.$attrs.class]}),[P.value?T(t.$slots,"error",{key:0},()=>[k("div",{class:v(e(w).e("error"))},Ne(e(r)("el.image.error")),3)]):(g(),z(Z,{key:1},[s.value!==void 0?(g(),z("img",be({key:0},e(se),{src:s.value,loading:t.loading,style:e(oe),class:e(l),crossorigin:t.crossorigin,onClick:ee,onLoad:ne,onError:le}),null,16,["src","loading","crossorigin"])):I("v-if",!0),L.value?(g(),z("div",{key:1,class:v(e(w).e("wrapper"))},[T(t.$slots,"placeholder",{},()=>[k("div",{class:v(e(w).e("placeholder"))},null,2)])],2)):I("v-if",!0)],64)),e(X)?(g(),z(Z,{key:2},[M.value?(g(),pe(e(ga),{key:0,"z-index":t.zIndex,"initial-index":e(G),infinite:t.infinite,"zoom-rate":t.zoomRate,"min-scale":t.minScale,"max-scale":t.maxScale,"show-progress":t.showProgress,"url-list":t.previewSrcList,crossorigin:t.crossorigin,"hide-on-click-modal":t.hideOnClickModal,teleported:t.previewTeleported,"close-on-press-escape":t.closeOnPressEscape,onClose:re,onSwitch:ie},na({toolbar:p(_=>[T(t.$slots,"toolbar",ke(Ie(_)))]),default:p(()=>[t.$slots.viewer?(g(),z("div",{key:0},[T(t.$slots,"viewer")])):I("v-if",!0)]),_:2},[t.$slots.progress?{name:"progress",fn:p(_=>[T(t.$slots,"progress",ke(Ie(_)))])}:void 0]),1032,["z-index","initial-index","infinite","zoom-rate","min-scale","max-scale","show-progress","url-list","crossorigin","hide-on-click-modal","teleported","close-on-press-escape"])):I("v-if",!0)],64)):I("v-if",!0)],16))}});var ka=ze(ba,[["__file","image.vue"]]);const _a=Oe(ka);export{_a as E};
